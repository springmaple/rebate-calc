<!DOCTYPE html>
<html>

<head>
  <title>Member</title>

  <link rel="stylesheet" href="../css/bootstrap.css">
  <link rel="stylesheet" href="../css/bootstrap-theme.css">

  <script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>
  <script src="../js/jquery-3.1.0.js"></script>
  <script src="../js/boostrap.js"></script>
  <script>if (window.module) module = window.module;</script>
  <script>
    const {ipcRenderer} = require('electron')
    const {getParamByName} = require('./../../lib/util.js')
    const map = {
      mbrName: 'mbr-name',
      mbrId: 'mbr-id',
      mbrHp: 'mbr-hp', 
      mbrIc: 'mbr-ic', 
      mbrEmail: 'mbr-email',
      mbrBankName: 'mbr-bank-name',
      mbrBankAcc: 'mbr-bank-acc',
      mbrJoinDate: 'mbr-join-date',
      mbrPackage: 'mbr-package',
      mbrRemark: 'mbr-remark'
    }
    const _id = getParamByName('_id', window.location.href)
    
    var _mbr = null
    var cnlUpdMbr = window.close

    function newMbr() {
      let mbrToIns = {}
      for (let key in map)
        mbrToIns[key] = $(`#${map[key]}`).val()
      ipcRenderer.send('new-mbr', mbrToIns)
      cnlUpdMbr()
    }

    function updMbr() {
      let mbrToUpd = {}
      for (let key in map) {
        let value = $(`#${map[key]}`).val() 
        if (value != _mbr[key])
          mbrToUpd[key] = value
      }

      if (!$.isEmptyObject(mbrToUpd))
        ipcRenderer.send('upd-mbr', {_id: _id, mbr: mbrToUpd})
      cnlUpdMbr()
    }

    ipcRenderer.on('get-mbr', (evt, mbr) => {
      _mbr = mbr
      for (let key in map)
        $(`#${map[key]}`).val(mbr[key]) 
    })

    if (_id)
      window.onload = function () {
        ipcRenderer.send('get-mbr', _id)
      }
  </script>

</head>

<body>
  <div class="container">
    <form class="form-horizontal">
      <div class="form-group">
        <label class="control-label col-sm-2" for="mbr-name">Name:</label>
        <div class="col-sm-10">
          <input type="text" class="form-control" id="mbr-name" placeholder="Enter name">
        </div>
      </div>
      <div class="form-group">
        <label class="control-label col-sm-2" for="mbr-id">ID:</label>
        <div class="col-sm-10">
          <input type="text" class="form-control" id="mbr-id" placeholder="Enter id">
        </div>
      </div>
      <div class="form-group">
        <label class="control-label col-sm-2" for="mbr-hp">Hp No:</label>
        <div class="col-sm-10">
          <input type="text" class="form-control" id="mbr-hp" placeholder="Enter hp no">
        </div>
      </div>
      <div class="form-group">
        <label class="control-label col-sm-2" for="mbr-ic">IC:</label>
        <div class="col-sm-10">
          <input type="text" class="form-control" id="mbr-ic" placeholder="Enter ic">
        </div>
      </div>
      <div class="form-group">
        <label class="control-label col-sm-2" for="mbr-email">Email:</label>
        <div class="col-sm-10">
          <input type="text" class="form-control" id="mbr-email" placeholder="Enter email">
        </div>
      </div>
      <div class="form-group">
        <label class="control-label col-sm-2" for="mbr-bank-name">Bank Name:</label>
        <div class="col-sm-10">
          <input type="text" class="form-control" id="mbr-bank-name" placeholder="Enter bank name">
        </div>
      </div>
      <div class="form-group">
        <label class="control-label col-sm-2" for="mbr-bank-acc">Bank Acc:</label>
        <div class="col-sm-10">
          <input type="text" class="form-control" id="mbr-bank-acc" placeholder="Enter bank acc">
        </div>
      </div>
      <div class="form-group">
        <label class="control-label col-sm-2" for="mbr-join-date">Join Date:</label>
        <div class="col-sm-10">
          <input type="text" class="form-control" id="mbr-join-date" placeholder="Enter join date">
        </div>
      </div>
      <div class="form-group">
        <label class="control-label col-sm-2" for="mbr-package">Package:</label>
        <div class="col-sm-10">
          <input type="text" class="form-control" id="mbr-package" placeholder="Enter package">
        </div>
      </div>
      <div class="form-group">
        <label class="control-label col-sm-2" for="mbr-remark">Remark:</label>
        <div class="col-sm-10">
          <textarea class="form-control" id="mbr-remark" rows="2" placeholder="Enter remark"></textarea>
        </div>
      </div>
      <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10" id="form-btn">
          <!-- INSERT BTN HERE -->
        </div>
      </div>
    </form>
  </div>
  <script>
    let btnTxt = null
    if (!_id)
      btnTxt = `<button onclick="newMbr()" class="btn btn-primary">Create Member</button>`
    else
      btnTxt = `<button onclick="updMbr()" class="btn btn-primary">Update</button>
                <button onclick="cnlUpdMbr()" class="btn btn-default">Cancel</button>`
    $('#form-btn').html(btnTxt)
  </script>
</body>

</html>